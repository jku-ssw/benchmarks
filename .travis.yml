language: c
before_install:
  - sudo apt-get install -y libpapi-dev python3-flake8 python3-pip
  - sudo pip3 install -r requirements.txt
script:
  # test code formatting
  - flake8 ./tools
  - flake8 ./configs --max-line-length=200 --ignore=F821

  # execute clang-O0 benchmark for all harnesses starting with 'a'
  - echo "CLANG=clang" > configs/env
  - echo "GCC=gcc" >> configs/env
  - echo "WLLVM_DIR=/usr/bin" >> configs/env
  - ./tools/bench.py -y my_results.json --filter-runtime=$FILTER_RUNTIME --exec-args="--warmup=0 --iterations=1" -j=4 $ARGS
matrix:
  include:
  - env: FILTER_RUNTIME='bugfinder-gcc-O2'
  - env: FILTER_RUNTIME='bugfinder-clang-O2'
after_failure:
  - ls --color ./benchmarks
